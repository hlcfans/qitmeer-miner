
## Qitmeer-miner

### Environment preparation (环境准备)

Before `compile`  qitmeer-miner, you need prepare the running environment:

- install [go](http://www.runoob.com/go/go-environment.html)，go version  >=1.12

- install [git](https://git-scm.com/downloads) 

 if you `compile` qitmeer-miner on windows, you also need prepare the running environment below:

- install [mingw-w64](http://www.mingw-w64.org/doku.php) , then add mingw-w64 bin path to windows：[guidance](https://www.cnblogs.com/ggg-327931457/p/9694516.html)

- install [cuda v10.1](https://developer.nvidia.com/cuda-downloads) 
  
  then set windows env，like `LIBRARY_PATH=C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.1\lib\x64`

  may be like this:    
  ![image](https://user-images.githubusercontent.com/32875657/61025357-0cd99300-a3e3-11e9-9d4d-582b7dfe3a05.png)

### Compile （编译）

- clone the repo

  `$ git clone https://github.com/HalalChain/qitmeer-miner.git`
  
- go build

  - Ubuntu ENV
         
  ```bash
  $ sudo apt-get install beignet-dev nvidia-cuda-dev nvidia-cuda-toolkit      
  $ go build  
  ```
  
  - Centos ENV
  
   ```bash
   $ sudo yum install opencl-headers
   $ sudo yum install ocl-icd
   $ sudo ln -s /usr/lib64/libOpenCL.so.1 /usr/lib/libOpenCL.so
   $ go build
   ```   

   - MAC    
   ```bash
   go build
   ```
   
   - Windows ENV
   
   ```bash
   $ go build 
   ```

### use qitmeer-miner for mining (挖矿)

- Modify config file （配置文件）

  - copy the config file:   
  `$ cp qitmeer.conf.example qitmeer.conf ` 
  
  - modify the config file `qitmeer.conf`. Solo-mining Config example below:
  
  ```bash
  # the miner config file
  
  #[log] miner submit log
  #minerlog=
  
  #[Necessary Config]
  #coin
  symbol=HLC
  #pow type cuckaroo|blake2bd|cuckatoo
  pow=blake2bd
  
  #[Solo Config]
  #miner address
  mineraddress=(your address)
  # node rpc server
  rpcserver=127.0.0.1:1234(node ip and port)
  # node rpc user
  rpcuser=test(node rpc user)
  # node rpc password
  rpcpass=test(node rpc password)
  #not tls
  notls=true
  #rpccert
  #rpccert=CA.cert
  
  #[Pool Config]
  #pool=stratum+tcp://47.93.20.102:3176
  #pooluser=TmbCBKbZF8PeSdj5Chm22T4hZRMJY5D8XyX
  #poolpass=
  
  #[Necessary Config]
  #trimmerCount
  #trimmerCount=60
  # Intensities (the work size is 2^intensity) up to device
  intensity=24
  # The explicitly declared sizes of the work to do up to device (overrides intensity)
  worksize=256
  ```
  
  
- run `qitmeer-miner` with the config file `qitmeer.conf`（执行挖矿程序）

   An executable file named `qitmeer-miner` will be generated by step of `go build`,on windows maybe is `qitmeer-miner.exe`.
  
    For convenience, you can create a new folder (assume named qitmeer-miner) and put `qitmeer-miner.exe` and `qitmeer.conf` together in the folder.Then run `qitmeer-miner.exe` in the command line window, using the command `qitmeer-miner -C qitmeer.conf`.
    
    If you have modified the config file `qitmeer.conf` correctly, you will see the feedback like below:
    
    ```bash
    > qitmeer-miner -C qitmeer.conf
    2019/07/20 18:00:44 solo miner start
    2019/07/20 18:00:45 Found Device : 0 | name: GeForce 920MX | MaxGroupSize: 1024 | MaxAllocMemory: 512.00 MB | MaxGlobalMemory: 2048.00 MB
    2019/07/20 18:00:45 Found Device : 1 | name: Intel(R) HD Graphics 620 | MaxGroupSize: 256 | MaxAllocMemory: 1611.68 MB | MaxGlobalMemory: 3223.35 MB
    2019/07/20 18:00:45 - Device ID: 0 - Global item size: 16777216 (Intensity 24 ) - Local item size: 256
    2019/07/20 18:00:46 - Device ID: 1 - Global item size: 16777216 (Intensity 24 ) - Local item size: 256
    2019/07/20 18:00:46 listen submit block server
    2019/07/20 18:00:46 listen new work server
    2019/07/20 18:00:50 DEVICE_ID #0 (GeForce 920MX) 5.154GH/s
    2019/07/20 18:00:51 Global stats: Accepted: 0,Stale: 0, Rejected: 0, Total: 0
    2019/07/20 18:00:51 DEVICE_ID #1 (Intel(R) HD Graphics 620) 1.432GH/s
    2019/07/20 18:00:52 [Found Hash] 0000000016dd63b8f03700e00c3fc8a5bf53dfde959331a5e8a5695a9f656e9d
    2019/07/20 18:00:55 DEVICE_ID #0 (GeForce 920MX) 6.872GH/s
    2019/07/20 18:00:56 Global stats: Accepted: 1,Stale: 0, Rejected: 0, Total: 1
    2019/07/20 18:00:56 DEVICE_ID #1 (Intel(R) HD Graphics 620) 2.343GH/s
    ```
   
   It means you are mining. 
   
  - run `qitmeer-miner` with command, example:
    
    ```bash
    qitmeer-miner -u admin -P 123 -s 47.74.00.00:1236 -M TmbCxGUCgQ3ohikouGXa8UjpZ27W3koHxAM -P blake2bd
    ```
    
  - use command `$ qitmeer-miner -h` for help:
  
  ```bash
  $ qitmeer-miner -h
     Usage:
       qitmeer-miner [OPTIONS]
     
     Debug Command:
       -l, --listdevices   List number of devices.
       -T, --testpow=      test pow blake2bd|cuckaroo|cuckatoo
     
     The Config File Options:
       -C, --configfile=   Path to configuration file (/Users/fanxu/www/go/src/hlc-miner/halalchainminer.conf)
           --minerlog=     Write miner log file (/Users/fanxu/www/go/src/hlc-miner/miner.log)
     
     The Necessary Config Options:
       -P, --pow=          blake2bd|cuckaroo|cuckatoo (cuckaroo)
       -S, --symbol=       Symbol (HLC)
     
     The Solo Config Option:
       -M, --mineraddress= Miner Address (RmN4SADy42FKmN8ARKieX9iHh9icptdgYNn)
       -s, --rpcserver=    RPC server to connect to (127.0.0.1:1234)
       -u, --rpcuser=      RPC username (test)
       -p, --rpcpass=      RPC password
           --randstr=      Rand String,Your Unique Marking. (Come from halalchain!)
           --notls         Do not verify tls certificates (true)
           --rpccert=      RPC server certificate chain for validation (CA.cert)
     
     The pool Config Option:
       -o, --pool=         Pool to connect to (e.g.stratum+tcp://pool:port)
       -m, --pooluser=     Pool username
       -n, --poolpass=     Pool password
     
     The Optional Config Option:
           --trimmerTimes= the cuckaroo trimmer times (40)
           --proxy=        Connect via SOCKS5 proxy (eg. 127.0.0.1:9050)
           --proxyuser=    Username for proxy server
           --proxypass=    Password for proxy server
           --intensity=    Intensities (the work size is 2^intensity) per device. Single global value or a comma
                           separated list. (24)
           --worksize=     The explicitly declared sizes of the work to do per device (overrides intensity). Single
                           global value or a comma separated list. (256)
     
     Help Options:
       -h, --help          Show this help message 
  ```   
  




## Building qitmeer node as a server （qitmeer节点搭建）

### Env preparation (环境准备)

- install [git](https://git-scm.com/downloads)

- Update Go to version at least 1.12 (required >= 1.12)

  - install [go](http://www.runoob.com/go/go-environment.html)

  - Check your golang version
  
  ```bash
   ~ go version
   go version go1.12 darwin/amd64 
  ```

### How to build

- clone qitmeer repo (克隆qitmeer仓库到本地)

  - `git clone https://github.com/HalalChain/qitmeer.git`
  
   - maybe need Personal access tokens: [setting](https://github.com/settings/tokens)

- `cd qitmeer` ，then `go build` qitmeer （打开本地的qitmeer仓库，编译qitmeer）

- run qitmeer using the command `./qitmeer` （运行qitmeer） 

  - this will creat a directory named `.qitmeerd`,and at the same time may report errors, you need stop qitmeer use `ctrl+c` 

  - then you need put the configuration file `qitmeerd.conf` into `.qitmeerd` directory, after that, run `./qitmeer` again 
  
- how to start qitmeer in the background (后台运行qitmeer)

  - To start qitmeer in the background, use command ``nohup ./qitmeer >log.log 2>&1 &``, this will output logs as log.log
  
  - view logs by using `tail -f log.log`
  
  - view the qitmeer process by using `ps -ef|grep qitmeer`
  
  - kill one process by using ``kill -2 <process number>``
  
- update qitmeer local repo（更新库）

  - use ``git pull``, then `go build` qitmeer and run `./qitmeer` again.
  
    Before update，you need kill the qitmeer process firstly. 

